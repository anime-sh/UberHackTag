{% extends "basetemplate.html" %}
{% block title %}Sign up{% endblock %}

{% block main %}

<div class="container">
  <div class="row">
    <div class="col">

      <h1>Sign up</h1>
      <hr>

      <!-- <form action="/sign-up" method="POST"> -->
      <div class="mb-3">
        <div class="form-group">
          <label>Username</label>
          <input type="text" class="form-control" id="username" name="username" placeholder="Select a username">
        </div>



        <div class="form-group">
          <label>Email</label>
          <input type="email" class="form-control" id="email" name="email" placeholder="Enter your email">
        </div>
        <div class="form-group">
          <label>Upload documents</label>
          <div class="custom-file">
            <input type="file" class="custom-file-input" name="file" id="file">
          </div>
        </div>

        <div class="button">
          <button type="submit" class="btn btn-primary" onclick="submit()">Sign up</button>

        </div>
      </div>
      <!-- </form> -->

    </div>
  </div>
</div>

{% endblock %}
{% block scripts %}

<script>
  function submit() {

    var username = document.getElementById("username");
    // console.log(`username ${username.value}`)
    var email = document.getElementById("email");
    var file = document.getElementById("file");

    var entry = {
      name: username.value,
      email: email.value,
      file: file.value
    };
    console.log(entry)
    fetch(`${window.origin}/sign-up/create_app`, {
      method: "POST",
      credentials: "include",
      body: JSON.stringify(entry),
      cache: "no-cache",
      headers: new Headers({
        "content-type": "application/json"
      })
    })
      .then(function (response) {
        if (response.status !== 200) {
          console.log(`Looks like there was a problem. Status code: ${response.status}`);
          return;
        }
        response.json().then(function (data_) {
          
          if (data_.message === "OK") {
            window.location.href=`${window.origin}/sign-up/success`;
          } else {
            window.location.href = `${window.origin}/sign-up/missing/${data_.message}`;
          }
        });
      })
      .catch(function (error) {
        console.log("Fetch error: " + error);
      });
  }
</script>

{% endblock %}